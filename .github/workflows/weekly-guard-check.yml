name: Weekly Guard Check (/api/shares)

on:
  workflow_dispatch:
  schedule:
    # 毎週月曜 10:00 JST（= 01:00 UTC）
    - cron: "0 1 * * 1"

permissions:
  contents: read

jobs:
  guard-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Verify script path (list files)
        shell: bash
        run: |
          echo "PWD=$(pwd)"
          ls -la
          echo "---- scripts ----"
          ls -la scripts || true
          echo "---- test file ----"
          test -f scripts/check-shares-guard.ps1 && echo "FOUND" || (echo "MISSING"; exit 2)

      - name: Run guard check script (PowerShell)
        shell: pwsh
        run: |
          ./scripts/check-shares-guard.ps1 -ProdUrl "${{ secrets.PROD_URL }}"
